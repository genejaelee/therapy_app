<!-- render javascript partials specific to chat -->
<% content_for :head do %>
<% end %>

<% content_for :title do %>
  Chat with your therapist.
<% end %>

<% content_for :body do %>
  <p></p>
	<%= render 'twilio/index' %>
<% end %>

<%= render 'layouts/header' %>

<script type="text/javascript">
	// Set the globals used by chat.js
	channel = "<%= @chat.channel %>";
	chat_id = "<%= @chat.id %>";
	user_id = "<%= @user.id %>";
	var PUSHER_KEY = '<%= Pusher.key %>'
</script>

<div class="panel chat-panel">
	<div id="helpline-bar">
		<div class="container">
			<div class="sixteen columns" id="helpline-header">
				<h3>+ <span>If you are in crisis, please click here for a helpline.</span></h3>
			</div>
			<dl class="font-sans collapse sixteen columns" id="helplines">
          <dt>Suicide Prevention Lifeline</dt>
          <dd>1-800-273-TALK(8255) or 1-800-SUICIDE(7842433)</h5></dd>

          <dt>Sexual Assault Hotline</dt>
          <dd>(574)-254-7473</dd>    

          <dt>US Veterans Crisis Hotline</dt>
          <dd>1-800-273-TALK(8255)</dd>

          <dt>Center to Prevent Youth Violence</dt>
          <dd>1-866-773-2587</dd>

          <dt>National Runaway Switchboard</dt>
          <dd>1-800-RUNAWAY</dd>

          <dt>The Trevor Project for LGBT teens</dt>
          <dd>1-800-488-7386</dd>

          <dt>Teen Line</dt>
          <dd><a href="http://teenlineonline.org" target="_blank">teenlineonline.org</a></dd>

          <dt>Safe Haven for self-injurers</dt>
          <dd><a href="http://gabrielle.self-injury.net" target="_blank">gabrielle.self-injury.net</a></dd> 

          <dt>Al-Anon / Alateen</dt>
          <dd><a href="http://www.al-anon.alateen.org" target="_blank">www.al-anon.alateen.org</a></dd> 
      </dl>
		</div>
	</div>
	<div class="bg-container">
		<div class="container">
			<ul id="messages">
				<% @messages.each_with_index do |message, index| %>
					<% user = ChatUser.find(message.user_id) %>
					<div class="message-container">
						<li <% if user.id == @user.id %> 
								class="you"
								<% else %>
								class="them"
								<% end %>>
								
								<%= puts "#{@messages[index].user_id}" %>
								<% unless (@messages[index - 1].user_id == message.user_id) && index != 0 %>
									<br>
									<span class="nickname-said"><strong class="nickname"><%= user.nickname %>&nbsp</strong>said:</span>
								<% end %>
							<!--
							<span class="timestamps">
								<% unless message.created_at.nil? %>
									<%= message.created_at.in_time_zone(user.time_zone).strftime('%a %I:%M %p %Z') %>
								<% end %>
							</span>
							<br>
								-->
							<div class="message-wrapper">
								<div class="message">
									<p><%= message.message %></p>
								</div>
							</div>
						</li>
					</div>
				<% end %>
			</ul>
			<div id="spinner" class="spinner" style="display: none; height: 50px; margin-bottom: 15px">
					<%= image_tag("loading.gif", :alt => "Loading", :height => "50px") %>
			</div>
			<div id="message-overlay"></div>
			<textarea id="message" name="message" placeholder="Type your message here and hit enter..."></textarea>
			<div class="header">
				<!--<div id="title" class="member_list_title">Pusher Chat (<span id="room_count">0</span>)</div>-->
				<div>
					<input type="text" value="<%= @user.nickname %>" id="nickname" />
				</div>
				<div class="change-nickname-container">
					<a href="#" id="changeNickname">Change nickname</a>
				</div>
			</div>
		</div>
	</div>
	<!--
	<div id="mobile-chat-input">
	</div>
		-->
</div>