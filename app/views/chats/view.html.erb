<!-- render javascript partials specific to chat -->
<% content_for :head do %>
<% end %>

<% content_for :title do %>
  Chat with your therapist.
<% end %>

<% content_for :body do %>
  <p></p>
<% end %>

<!--
<%= render 'layouts/header' %>
-->

<script type="text/javascript">
	// Set the globals used by chat.js
	channel = "<%= @chat.channel %>";
	chat_id = "<%= @chat.id %>";
	user_id = "<%= @user.id %>";
	var PUSHER_KEY = '<%= Pusher.key %>'
</script>

<div id="chatroom">

<div class="left-panel chat-panel">
	<div id="chat-navbar">
		<p>
			Session scheduled to start at <%= Time.zone.parse(@chat.event.suggested_times[0]).in_time_zone(current_user.time_zone).strftime('%b %d, %Y @ %I:%M%p') %>.
		</p>
	</div>
	
	<div class="messages-panel">
		<div class="container">
			<ul id="messages">
				<div class="messages-container">
					<% @messages.each_with_index do |message, index| %>
						<% user = ChatUser.find(message.user_id) %>
						<div class="message-container">
							<li <% if user.id == @user.id %> 
									class="you"
									<% else %>
									class="them"
									<% end %>>
								
									<%= puts "#{@messages[index].user_id}" %>
									<% unless (@messages[index - 1].user_id == message.user_id) && index != 0 %>
										<br>
										<span class="nickname-said"><strong class="nickname"><%= user.nickname %>&nbsp</strong>said:</span>
									<% end %>
								<!--
								<span class="timestamps">
									<% unless message.created_at.nil? %>
										<%= message.created_at.in_time_zone(user.time_zone).strftime('%a %I:%M %p %Z') %>
									<% end %>
								</span>
								<br>
									-->
								<div class="message-wrapper">
									<div class="message">
										<p><%= message.message %></p>
									</div>
								</div>
							</li>
						</div>
					<% end %>
				</div>
				<div id="spinner" class="spinner">
						<%= image_tag("loading.gif", :alt => "Loading", :height => "50px") %>
				</div>
				<div id="message-overlay"></div>
			</ul>
		</div>
	</div>
		
	<div class="chat-input-panel">
		<textarea id="message" name="message" placeholder="Type your message here and hit enter..."></textarea>
		<!--<div id="title" class="member_list_title">Pusher Chat (<span id="room_count">0</span>)</div>-->
		<!--
		<div class="change-nickname-container">
			<div style="display: inline-block">
				<input type="text" value="<%= @user.nickname %>" id="nickname" />
			</div>
			<div class="change-nickname-button" style="display: inline-block">
				<a href="#" id="changeNickname">Change</a>
			</div>
		</div>
			-->
	</div>
		
</div>

<div class="sidebar">
	<div class="sidebar-container">
		<div id="logo-banner">
			<%= link_to image_tag("couch-logo5.png", class: "top-logo"), homepage_path %>
			<p>Plain <span style="font-weight: 600;">White</span> Couch</p>
		</div>
		<hr class="blue-hr">
		<%= render :partial => 'twilio/call' %>
		<hr>
		<div class="helplines-button-container sidebar-section">
			<button class="helplines-button">Helplines</button>
		</div>
		<hr>
		<% if current_user.role_type == "Therapist" %>
		<div class="timer-button-container">
			<button class="timer-start-button">Start</button>
			<button class="timer-toggle-button" style="display: none;">Pause</button>
			<button class="timer-reset-button">Reset</button>
		</div>
		<% elsif current_user.role_type == "Client" %>
		<% end %>
	</div>
	
	<div class="sidebar-clock">
		<div class="clock-circle" id="clock-back">
			<span class="timer notstarted">Hello.<div data-time="-0m -0s"></div></span>
		</div>
		<div class="clock-circle" id="clock-front">
			<div class="content clock-circle-concentric">
				<p>timer</p>
			</div>
		</div>
	</div>
</div>

<div id="sidebar-cards">
	<div id="helplines-card" class="sidebar-card closed">
		<div class="helplines-container">
			<div class="sixteen columns" id="helpline-header">
			</div>
			<dl class="font-sans collapse sixteen columns" id="helplines">
				<h3>Helplines</h3>
				<hr>
	        <div class="helpline-container">
		        <dt>Suicide Prevention Lifeline</dt>
		        <dd>1-800-273-TALK(8255) or 1-800-SUICIDE(7842433)</dd>
					</div>
					<div class="helpline-container">
		        <dt>Sexual Assault Hotline</dt>
		        <dd>(574)-254-7473</dd>    
					</div>
					<div class="helpline-container">
		        <dt>US Veterans Crisis Hotline</dt>
		        <dd>1-800-273-TALK(8255)</dd>
					</div>
					<div class="helpline-container">
		        <dt>Center to Prevent Youth Violence</dt>
		        <dd>1-866-773-2587</dd>
					</div>
					<div class="helpline-container">
		        <dt>National Runaway Switchboard</dt>
		        <dd>1-800-RUNAWAY</dd>
					</div>
					<div class="helpline-container">
		        <dt>The Trevor Project for LGBT teens</dt>
		        <dd>1-800-488-7386</dd>
					</div>
					<div class="helpline-container">
		        <dt>Teen Line</dt>
		        <dd><a href="http://teenlineonline.org" target="_blank">teenlineonline.org</a></dd>
					</div>
					<div class="helpline-container">
		        <dt>Safe Haven for self-injurers</dt>
		        <dd><a href="http://gabrielle.self-injury.net" target="_blank">gabrielle.self-injury.net</a></dd> 
					</div>
					<div class="helpline-container">
		        <dt>Al-Anon / Alateen</dt>
		        <dd><a href="http://www.al-anon.alateen.org" target="_blank">www.al-anon.alateen.org</a></dd>
					</div>
				</div>
	    </dl>
		</div>
	</div>
</div>

</div>